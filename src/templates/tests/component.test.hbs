{{!-- Component Test Generator (Vitest + React Testing Library) --}}
import { {{pascalCase entity}}Form } from '@/components/{{camelCase entity}}/{{pascalCase entity}}Form';
import { renderWithProviders } from '@/utils/test-utils';
import { screen, waitFor } from '@testing-library/react';
import { beforeEach, describe, expect, it, vi } from 'vitest';

describe('{{pascalCase entity}}Form', () => {
const mockOnSubmit = vi.fn();

beforeEach(() => {
mockOnSubmit.mockClear();
});

it('should render all form fields', async () => {
renderWithProviders(<{{pascalCase entity}}Form onSubmit={mockOnSubmit} />);

{{#each formFields}}
expect(await screen.findByLabelText(/^{{#if ui.form.label}}{{ui.form.label}}{{else}}{{name}}{{/if}}/i)).toBeInTheDocument();
{{/each}}
});


it('should show validation errors for required fields', async () => {
const { user } = renderWithProviders(<{{pascalCase entity}}Form onSubmit={mockOnSubmit} />);

const submitButton = await screen.findByRole('button', { name: /create/i });
await user.click(submitButton);

{{#each formFields}}
{{#if validation.required}}
expect(await screen.findByText("{{#if ui.form.label}}{{ui.form.label}}{{else}}{{name}}{{/if}} is required")).toBeInTheDocument();
{{/if}}
{{/each}}

expect(mockOnSubmit).not.toHaveBeenCalled();
});

it('should call onSubmit with form values when valid', async () => {
const { user } = renderWithProviders(<{{pascalCase entity}}Form onSubmit={mockOnSubmit} />);

{{#each formFields}}
{{#ifEq ui.form.component 'Input'}}
const {{name}}Input = await screen.findByLabelText(/^{{#if ui.form.label}}{{ui.form.label}}{{else}}{{name}}{{/if}}/i);
await user.type({{name}}Input, 'test value');
{{/ifEq}}
{{/each}}

const submitButton = screen.getByRole('button', { name: /create/i });
await user.click(submitButton);

await waitFor(() => {
expect(mockOnSubmit).toHaveBeenCalled();
});
});

it('should render in edit mode with correct button text', async () => {
renderWithProviders(<{{pascalCase entity}}Form onSubmit={mockOnSubmit} mode="edit" />);

expect(await screen.findByRole('button', { name: /update/i })).toBeInTheDocument();
});

it('should display loading state when submitting', () => {
renderWithProviders(<{{pascalCase entity}}Form onSubmit={mockOnSubmit} isSubmitting={true} />);

const submitButton = screen.getByRole('button', { name: /create/i });
expect(submitButton).toHaveAttribute('data-loading');
});

it('should populate initial values in edit mode', async () => {
const initialValues = {
{{#each formFields}}
{{name}}: 'initial {{name}} value',
{{/each}}
};

renderWithProviders(
<{{pascalCase entity}}Form onSubmit={mockOnSubmit} initialValues={initialValues} mode="edit" />
);

{{#each formFields}}
{{#ifEq ui.form.component 'Input'}}
expect(await screen.findByLabelText(/^{{#if ui.form.label}}{{ui.form.label}}{{else}}{{name}}{{/if}}/i)).toHaveValue('initial {{name}} value');
{{/ifEq}}
{{/each}}
});
});