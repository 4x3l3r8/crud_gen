{{!-- Table Component Generator (TanStack React Table) --}}
import { useMemo, useState } from 'react';
import { createColumnHelper } from '@tanstack/react-table';
import { IconButton, Portal, Menu } from '@chakra-ui/react';
{{#if mutationUIisPage}}
import { useNavigate } from 'react-router-dom';
{{/if}}
import { TableComponent } from '@/components/ui/datatable';
import type { {{pascalCase entity}} } from '@/types/{{camelCase entity}}';
import { use{{pascalCase entity}} } from '@/hooks/use{{entity}}';
import { CgMoreVertical } from 'react-icons/cg';
{{#if mutationUIisModal}}
import { Edit{{pascalCase entity}}Modal } from './{{entity}}EditModal';
import { Delete{{pascalCase entity}}Modal } from './{{entity}}DeleteModal';
{{/if}}
{{#if mutationUIisDrawer}}
import { Edit{{pascalCase entity}}Drawer } from './{{entity}}EditDrawer';
import { Delete{{pascalCase entity}}Drawer } from './{{entity}}DeleteDrawer';
{{/if}}
{{#ifEq views.details.type 'modal'}}
import { View{{pascalCase entity}}Modal } from './{{entity}}ViewModal';
{{/ifEq}}

const columnHelper = createColumnHelper<{{pascalCase entity}}>();

    export const {{pascalCase entity}}Table = () => {
    {{#if mutationUIisPage}}
    const navigate = useNavigate();
    {{/if}}
    const [page, setPage] = useState(1);
    const {useList, goToEdit, goToDetails} = use{{pascalCase entity}}();

    const { data, isLoading, isFetching } = useList({
    page,
    limit: {{pagination.defaultPageSize}},
    });
    const [deleteId, setDeleteId] = useState<string | null>(null);
        const [openDeleteModal, setOpenDeleteModal] = useState(false);
        const [editId, setEditId] = useState<string | null>(null);
            const [openEditModal, setOpenEditModal] = useState(false);
            {{#ifEq views.details.type 'modal'}}
            const [viewId, setViewId] = useState<string | null>(null);
                const [openViewModal, setOpenViewModal] = useState(false);
            {{/ifEq}}

                const setEdit = (id: string) => {
                {{#if mutationUIisModal}}
                setEditId(id)
                setOpenEditModal(true)
                {{/if}}
                {{#if mutationUIisPage}}
                goToEdit(id)
                {{/if}}
                }

                const setView = (id: string) => {
                {{#ifEq views.details.type 'modal'}}
                setViewId(id)
                setOpenViewModal(true)
                {{/ifEq}}
                {{#ifEq views.details.type 'page'}}
                goToDetails(id)
                {{/ifEq}}
                }

                const setDelete = (id: string) => {
                setDeleteId(id)
                setOpenDeleteModal(true)
                }

                const MoreMenu = ({id}: {id: string}) => {
                return (
                <Menu.Root>
                    <Menu.Trigger asChild>
                        <IconButton aria-label="Table Actions" variant="ghost">
                            <CgMoreVertical />
                        </IconButton>
                    </Menu.Trigger>
                    <Portal>
                        <Menu.Positioner>
                            <Menu.Content>
                                {{#if views.details}}
                                <Menu.Item value="view" onClick={()=> setView(id)}>
                                    View
                                </Menu.Item>
                                {{/if}}

                                <Menu.Item value="edit" onClick={()=> setEdit(id)}>
                                    Edit
                                </Menu.Item>
                                <Menu.Separator />
                                <Menu.Item value="delete" color="fg.error" _hover={ { bg: "bg.error" , color: "fg.error" } } onClick={()=> setDelete(id)}>
                                    Delete
                                </Menu.Item>
                            </Menu.Content>
                        </Menu.Positioner>
                    </Portal>
                </Menu.Root>
                )
                }

                const columns = useMemo(
                () => [
                {{#each tableFields}}
                columnHelper.accessor('{{name}}', {
                header: '{{#if ui.table.header}}{{ui.table.header}}{{else}}{{name}}{{/if}}',
                cell: (info) => info.getValue(),
                {{#unless ui.table.sortable}}
                enableSorting: true,
                {{/unless}}
                }),
                {{/each}}
                columnHelper.accessor('id',{
                id: 'actions',
                header: 'Actions',
                cell: ({ row }) => (
                <MoreMenu id={row.original.id} />
                ),
                }),
                ],
                []
                );

                return (
                <>
                    <TableComponent columns={columns} data={data?.data || []} isLoading={isLoading || isFetching} pagination={ { page, limit: {{pagination.defaultPageSize}}, total: data?.meta?.total || 0, onPageChange: setPage, } } />

                    {{#ifEq views.details.type 'modal'}}
                    {viewId && openViewModal && <View{{pascalCase entity}}Modal open={openViewModal} setOpen={setOpenViewModal} id={viewId as string} />}
                    {{/ifEq}}

                    {{!-- render the drawer if the mutationUIisDrawer is true --}}
                    {{#ifEq mutationUIisDrawer true}}
                    {editId && openEditModal && <Edit{{pascalCase entity}}Drawer open={openEditModal} setOpen={setOpenEditModal} id={editId as string} />}
                    {{/ifEq}}

                    {{!-- render the modal if the mutationUIisModal is true --}}
                    {{#ifEq mutationUIisModal true}}
                    {editId && openEditModal && <Edit{{pascalCase entity}}Modal open={openEditModal} setOpen={setOpenEditModal} id={editId as string} />}
                    {{/ifEq}}

                    {deleteId && openDeleteModal && <Delete{{pascalCase entity}}Modal open={openDeleteModal} setOpen={setOpenDeleteModal} id={deleteId as string} />}
                </>
                );
                };